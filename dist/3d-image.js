!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.image3D=e():t.image3D=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=new(i(1).default);e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),r=i(3);e.default=class{constructor(){this.images=[]}process(t){let e;if(n.isString(t)?e=document.querySelector(t):n.isElement(t)&&(e=t),!e)return;const i=e.getAttribute("data-src"),o=e.getAttribute("data-depth-src"),a=new r.default(e,i,o);this.images.push(a)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isWindow=function(t){return!!t&&t===t.window},e.isDocument=function(t){return!!t&&9===t.nodeType},e.isElement=function(t){return!!t&&1===t.nodeType},e.isFunction=function(t){return"function"==typeof t},e.isString=function(t){return"string"==typeof t},e.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(a,s)}u((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=i(4),o=i(5),a=i(6),s=i(7);e.default=class{constructor(t,e,i){this.target=t,this.src=e,this.depthSrc=i,this.blockRepaint=!1,this.pixelRatio=1,this.setup()}setup(){return n(this,void 0,void 0,function*(){this.canvas=yield this.createCanvas(this.target),this.target.appendChild(this.canvas),r.default.subscribe({target:this.target,onVisible:()=>this.blockRepaint=!1,onInvisible:()=>this.blockRepaint=!0})})}loadImage(t){return n(this,void 0,void 0,function*(){const e=new Image;return e.src=t,yield new Promise(t=>e.onload=t),e})}createCanvas(t){return n(this,void 0,void 0,function*(){const t=yield this.loadImage(this.src),e=yield this.loadImage(this.depthSrc),i=document.createElement("canvas");i.height=t.height*this.pixelRatio,i.width=t.width*this.pixelRatio;const n=i.getContext("webgl");Object.assign(i.style,{maxWidth:"100vw",maxHeight:"100vh",objectFit:"contain",width:"100%",height:"100%"});const r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,1]),n.STATIC_DRAW),n.vertexAttribPointer(0,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(0);const u=o.default,c=n.createShader(n.VERTEX_SHADER);n.shaderSource(c,u),n.compileShader(c);const l=a.default,d=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(d,l),n.compileShader(d);const f=n.createProgram();function h(t,e,i){var r=n.createTexture();n.activeTexture(n.TEXTURE0+i),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),n.uniform1i(n.getUniformLocation(f,e),i)}n.attachShader(f,d),n.attachShader(f,c),n.linkProgram(f),n.useProgram(f),h(t,"img",0),h(e,"depth",1);const p=()=>{this.blockRepaint||(n.clearColor(.25,.65,1,1),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_STRIP,0,4))};p();const b=n.getUniformLocation(f,a.MOUSE_VECTOR_NAME);return i.onmousemove=function(t){const e=s.getRelativeMousePosition(t);n.uniform2fv(b,new Float32Array(e)),requestAnimationFrame(()=>p())},s.DeviceOrientation.subscribe((t,e,i)=>{const r=[-.015*i,-.015*e];n.uniform2fv(b,new Float32Array(r)),requestAnimationFrame(()=>p())}),this.gl=n,i})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n="data-ioid";e.default=new class{constructor(){this.subscribers={},this.subscribersCount=0,this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(t=>{const e=t.target,i=e.getAttribute(n),r=this.subscribers[i];r&&(t.isIntersecting?(r.onVisible(),console.log("VISIBLE!",e)):(r.onInvisible(),console.log("invisible!",e)))})},{root:null,rootMargin:"0px 0px 0px 0px",threshold:0})}subscribe(t){const{target:e,onVisible:i,onInvisible:r}=t;if(!e)return;this.subscribersCount++;const o=this.subscribersCount.toString();e.setAttribute(n,o),this.subscribers[o]=t,this.intersectionObserver.observe(e)}unsubscribe(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\n    attribute vec2 pos;\n    varying vec2 vpos;\n    void main(){\n        vpos = pos*-0.5 + vec2(0.5);\n        gl_Position = vec4(pos, 0.0, 1.0);\n    }\n    "},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MOUSE_VECTOR_NAME="mouse",e.default=`\n    precision highp float;\n    uniform sampler2D img;\n    uniform sampler2D depth;\n    uniform vec2 ${e.MOUSE_VECTOR_NAME};\n    varying vec2 vpos;\n    void main(){\n        float dp = -0.5 + texture2D(depth, vpos).x;\n        gl_FragColor = texture2D(img, vpos + ${e.MOUSE_VECTOR_NAME} * 0.2 * dp);\n    }\n    `},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getRelativeMousePosition=function(t){const e=t.target.getBoundingClientRect(),i=e.width,n=e.height,r=e.left,o=e.top;return[(t.clientX-r)/i-.5,.5-(t.clientY-o)/n]};e.DeviceOrientation=new class{constructor(){this.subscribers=[],this.initialData=null,this.data={alpha:0,beta:0,gamma:0},window.addEventListener("deviceorientation",t=>{this.updateOrientationData(t),this.subscribers.forEach(t=>{t(this.data.alpha,this.data.beta,this.data.gamma)})},!1)}subscribe(t){this.subscribers.push(t)}updateOrientationData(t){this.initialData||(this.initialData={alpha:t.alpha,beta:t.beta,gamma:t.gamma}),this.data.alpha=t.alpha-this.initialData.alpha,this.data.gamma=-1*(-t.gamma+this.initialData.gamma),this.data.beta=-1*(t.beta-this.initialData.beta)}}}]).default});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9pbWFnZTNEL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9pbWFnZTNEL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2ltYWdlM0QvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vaW1hZ2UzRC8uL3NyYy9JbWFnZU1hbmFnZXIudHMiLCJ3ZWJwYWNrOi8vaW1hZ2UzRC8uL3NyYy90eXBlX2NoZWNraW5nLnRzIiwid2VicGFjazovL2ltYWdlM0QvLi9zcmMvSW1hZ2UzRC50cyIsIndlYnBhY2s6Ly9pbWFnZTNELy4vc3JjL09ic2VydmVyLnRzIiwid2VicGFjazovL2ltYWdlM0QvLi9zcmMvc2hhZGVycy92ZXJ0ZXgudHMiLCJ3ZWJwYWNrOi8vaW1hZ2UzRC8uL3NyYy9zaGFkZXJzL2ZyYWdtZW50LnRzIiwid2VicGFjazovL2ltYWdlM0QvLi9zcmMvZ2V0UmVsYXRpdmVNb3VzZVBvc2l0aW9uLnRzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsIndpbmRvdyIsImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJpbWFnZTNEIiwiZGVmYXVsdCIsInR5cGVfY2hlY2tpbmdfMSIsIkltYWdlM0RfMSIsIltvYmplY3QgT2JqZWN0XSIsInRoaXMiLCJpbWFnZXMiLCJzZWxlY3RvciIsInRhcmdldCIsImlzU3RyaW5nIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaXNFbGVtZW50Iiwic3JjIiwiZ2V0QXR0cmlidXRlIiwiZGVwdGhTcmMiLCJwdXNoIiwiaXNXaW5kb3ciLCJ4IiwiaXNEb2N1bWVudCIsIm5vZGVUeXBlIiwiaXNGdW5jdGlvbiIsImlzTnVtZXJpYyIsImlzTmFOIiwicGFyc2VGbG9hdCIsImlzRmluaXRlIiwiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYnNlcnZlcl8xIiwidmVydGV4XzEiLCJmcmFnbWVudF8xIiwiZ2V0UmVsYXRpdmVNb3VzZVBvc2l0aW9uXzEiLCJibG9ja1JlcGFpbnQiLCJwaXhlbFJhdGlvIiwic2V0dXAiLCJjYW52YXMiLCJjcmVhdGVDYW52YXMiLCJhcHBlbmRDaGlsZCIsInN1YnNjcmliZSIsIm9uVmlzaWJsZSIsIm9uSW52aXNpYmxlIiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJsb2FkSW1hZ2UiLCJkZXB0aEltZyIsImNyZWF0ZUVsZW1lbnQiLCJoZWlnaHQiLCJ3aWR0aCIsImdsIiwiZ2V0Q29udGV4dCIsImFzc2lnbiIsInN0eWxlIiwibWF4V2lkdGgiLCJtYXhIZWlnaHQiLCJvYmplY3RGaXQiLCJidWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJiaW5kQnVmZmVyIiwiQVJSQVlfQlVGRkVSIiwiYnVmZmVyRGF0YSIsIkZsb2F0MzJBcnJheSIsIlNUQVRJQ19EUkFXIiwidmVydGV4QXR0cmliUG9pbnRlciIsIkZMT0FUIiwiZW5hYmxlVmVydGV4QXR0cmliQXJyYXkiLCJ2U2hhZGVyIiwidnMiLCJjcmVhdGVTaGFkZXIiLCJWRVJURVhfU0hBREVSIiwic2hhZGVyU291cmNlIiwiY29tcGlsZVNoYWRlciIsImZTaGFkZXIiLCJmcyIsIkZSQUdNRU5UX1NIQURFUiIsInByb2dyYW0iLCJjcmVhdGVQcm9ncmFtIiwic2V0VGV4dHVyZSIsImltYWdlIiwibnVtIiwidGV4dHVyZSIsImNyZWF0ZVRleHR1cmUiLCJhY3RpdmVUZXh0dXJlIiwiVEVYVFVSRTAiLCJiaW5kVGV4dHVyZSIsIlRFWFRVUkVfMkQiLCJ0ZXhQYXJhbWV0ZXJpIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiTElORUFSIiwiVEVYVFVSRV9XUkFQX1MiLCJDTEFNUF9UT19FREdFIiwiVEVYVFVSRV9XUkFQX1QiLCJ0ZXhJbWFnZTJEIiwiUkdCQSIsIlVOU0lHTkVEX0JZVEUiLCJ1bmlmb3JtMWkiLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJhdHRhY2hTaGFkZXIiLCJsaW5rUHJvZ3JhbSIsInVzZVByb2dyYW0iLCJsb29wIiwiY2xlYXJDb2xvciIsImNsZWFyIiwiQ09MT1JfQlVGRkVSX0JJVCIsImRyYXdBcnJheXMiLCJUUklBTkdMRV9TVFJJUCIsImxvY2F0aW9uIiwiTU9VU0VfVkVDVE9SX05BTUUiLCJvbm1vdXNlbW92ZSIsIm1vdXNlUG9zaXRpb24iLCJnZXRSZWxhdGl2ZU1vdXNlUG9zaXRpb24iLCJ1bmlmb3JtMmZ2IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiRGV2aWNlT3JpZW50YXRpb24iLCJhbHBoYSIsImJldGEiLCJnYW1tYSIsImRldmljZVBvc2l0aW9uIiwiSURfQVRUUl9OQU1FIiwic3Vic2NyaWJlcnMiLCJzdWJzY3JpYmVyc0NvdW50IiwiaW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJJbnRlcnNlY3Rpb25PYnNlcnZlciIsImVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJpZCIsInN1YnNjcmliZXIiLCJpc0ludGVyc2VjdGluZyIsImNvbnNvbGUiLCJsb2ciLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwidG9TdHJpbmciLCJzZXRBdHRyaWJ1dGUiLCJvYnNlcnZlIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImxlZnQiLCJ0b3AiLCJjbGllbnRYIiwiY2xpZW50WSIsImluaXRpYWxEYXRhIiwiZGF0YSIsImFkZEV2ZW50TGlzdGVuZXIiLCJ1cGRhdGVPcmllbnRhdGlvbkRhdGEiLCJmbiJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsSUFDQSxtQkFBQUcsZUFBQUMsSUFDQUQsT0FBQSxHQUFBSCxHQUNBLGlCQUFBQyxRQUNBQSxRQUFBLFFBQUFELElBRUFELEVBQUEsUUFBQUMsSUFSQSxDQVNDSyxPQUFBLFdBQ0QsbUJDVEEsSUFBQUMsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBUCxRQUdBLElBQUFDLEVBQUFJLEVBQUFFLEdBQUEsQ0FDQUMsRUFBQUQsRUFDQUUsR0FBQSxFQUNBVCxRQUFBLElBVUEsT0FOQVUsRUFBQUgsR0FBQUksS0FBQVYsRUFBQUQsUUFBQUMsSUFBQUQsUUFBQU0sR0FHQUwsRUFBQVEsR0FBQSxFQUdBUixFQUFBRCxRQTBEQSxPQXJEQU0sRUFBQU0sRUFBQUYsRUFHQUosRUFBQU8sRUFBQVIsRUFHQUMsRUFBQVEsRUFBQSxTQUFBZCxFQUFBZSxFQUFBQyxHQUNBVixFQUFBVyxFQUFBakIsRUFBQWUsSUFDQUcsT0FBQUMsZUFBQW5CLEVBQUFlLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNWLEVBQUFnQixFQUFBLFNBQUF0QixHQUNBLG9CQUFBdUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQW5CLEVBQUF1QixPQUFBQyxZQUFBLENBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBbkIsRUFBQSxjQUFpRHlCLE9BQUEsS0FRakRuQixFQUFBb0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQW5CLEVBQUFtQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxL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QixNQUFBNUYsRUFBQTRGLE1BQ0FDLEtBQUE3RixFQUFBNkYsS0FDQUMsTUFBQTlGLEVBQUE4RixRQUdBOUgsS0FBQXlKLEtBQUE3QixNQUFBNUYsRUFBQTRGLE1BQUE1SCxLQUFBd0osWUFBQTVCLE1BQ0E1SCxLQUFBeUosS0FBQTNCLE9BQUEsSUFBQTlGLEVBQUE4RixNQUFBOUgsS0FBQXdKLFlBQUExQixPQUNBOUgsS0FBQXlKLEtBQUE1QixNQUFBLEdBQUE3RixFQUFBNkYsS0FBQTdILEtBQUF3SixZQUFBM0IiLCJmaWxlIjoiM2QtaW1hZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJpbWFnZTNEXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImltYWdlM0RcIl0gPSBmYWN0b3J5KCk7XG59KSh3aW5kb3csIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IEltYWdlTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vSW1hZ2VNYW5hZ2VyXCIpO1xyXG5jb25zdCBpbWFnZTNEID0gbmV3IEltYWdlTWFuYWdlcl8xLmRlZmF1bHQoKTtcclxuZXhwb3J0cy5kZWZhdWx0ID0gaW1hZ2UzRDtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgdHlwZV9jaGVja2luZ18xID0gcmVxdWlyZShcIi4vdHlwZV9jaGVja2luZ1wiKTtcclxuY29uc3QgSW1hZ2UzRF8xID0gcmVxdWlyZShcIi4vSW1hZ2UzRFwiKTtcclxuY2xhc3MgSW1hZ2VNYW5hZ2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuaW1hZ2VzID0gW107XHJcbiAgICB9XHJcbiAgICBwcm9jZXNzKHNlbGVjdG9yKSB7XHJcbiAgICAgICAgbGV0IHRhcmdldDtcclxuICAgICAgICBpZiAodHlwZV9jaGVja2luZ18xLmlzU3RyaW5nKHNlbGVjdG9yKSkge1xyXG4gICAgICAgICAgICB0YXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodHlwZV9jaGVja2luZ18xLmlzRWxlbWVudChzZWxlY3RvcikpIHtcclxuICAgICAgICAgICAgdGFyZ2V0ID0gc2VsZWN0b3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGFyZ2V0KVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gZ2V0dGluZyBpbWFnZXMgc291cmNlXHJcbiAgICAgICAgY29uc3Qgc3JjID0gdGFyZ2V0LmdldEF0dHJpYnV0ZShgZGF0YS1zcmNgKTtcclxuICAgICAgICBjb25zdCBkZXB0aFNyYyA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoYGRhdGEtZGVwdGgtc3JjYCk7XHJcbiAgICAgICAgY29uc3QgaW1hZ2UzRCA9IG5ldyBJbWFnZTNEXzEuZGVmYXVsdCh0YXJnZXQsIHNyYywgZGVwdGhTcmMpO1xyXG4gICAgICAgIHRoaXMuaW1hZ2VzLnB1c2goaW1hZ2UzRCk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5kZWZhdWx0ID0gSW1hZ2VNYW5hZ2VyO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyBzdG9sZW4gZnJvbSBLZW4gV2hlZWxlcnMgXCJDYXNoXCJcclxuZnVuY3Rpb24gaXNXaW5kb3coeCkge1xyXG4gICAgcmV0dXJuICEheCAmJiB4ID09PSB4LndpbmRvdztcclxufVxyXG5leHBvcnRzLmlzV2luZG93ID0gaXNXaW5kb3c7XHJcbmZ1bmN0aW9uIGlzRG9jdW1lbnQoeCkge1xyXG4gICAgcmV0dXJuICEheCAmJiB4Lm5vZGVUeXBlID09PSA5O1xyXG59XHJcbmV4cG9ydHMuaXNEb2N1bWVudCA9IGlzRG9jdW1lbnQ7XHJcbmZ1bmN0aW9uIGlzRWxlbWVudCh4KSB7XHJcbiAgICByZXR1cm4gISF4ICYmIHgubm9kZVR5cGUgPT09IDE7XHJcbn1cclxuZXhwb3J0cy5pc0VsZW1lbnQgPSBpc0VsZW1lbnQ7XHJcbmZ1bmN0aW9uIGlzRnVuY3Rpb24oeCkge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB4ID09PSBcImZ1bmN0aW9uXCI7XHJcbn1cclxuZXhwb3J0cy5pc0Z1bmN0aW9uID0gaXNGdW5jdGlvbjtcclxuZnVuY3Rpb24gaXNTdHJpbmcoeCkge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB4ID09PSBcInN0cmluZ1wiO1xyXG59XHJcbmV4cG9ydHMuaXNTdHJpbmcgPSBpc1N0cmluZztcclxuZnVuY3Rpb24gaXNOdW1lcmljKHgpIHtcclxuICAgIHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdCh4KSkgJiYgaXNGaW5pdGUoeCk7XHJcbn1cclxuZXhwb3J0cy5pc051bWVyaWMgPSBpc051bWVyaWM7XHJcbi8vIGNvbnN0IHsgaXNBcnJheSB9ID0gQXJyYXk7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IE9ic2VydmVyXzEgPSByZXF1aXJlKFwiLi9PYnNlcnZlclwiKTtcclxuY29uc3QgdmVydGV4XzEgPSByZXF1aXJlKFwiLi9zaGFkZXJzL3ZlcnRleFwiKTtcclxuY29uc3QgZnJhZ21lbnRfMSA9IHJlcXVpcmUoXCIuL3NoYWRlcnMvZnJhZ21lbnRcIik7XHJcbmNvbnN0IGdldFJlbGF0aXZlTW91c2VQb3NpdGlvbl8xID0gcmVxdWlyZShcIi4vZ2V0UmVsYXRpdmVNb3VzZVBvc2l0aW9uXCIpO1xyXG5jbGFzcyBJbWFnZTNEIHtcclxuICAgIGNvbnN0cnVjdG9yKHRhcmdldCwgc3JjLCBkZXB0aFNyYykge1xyXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3JjID0gc3JjO1xyXG4gICAgICAgIHRoaXMuZGVwdGhTcmMgPSBkZXB0aFNyYztcclxuICAgICAgICB0aGlzLmJsb2NrUmVwYWludCA9IGZhbHNlO1xyXG4gICAgICAgIC8vVE9ETyBoaWdoIHBpeGVsIHJhdGlvIGNhdXNlcyBkcmFzdGljIHBlcmZvcm1hbmNlIGlzc3VlcyBXVEZcclxuICAgICAgICAvLyB0aGlzLnBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcclxuICAgICAgICB0aGlzLnBpeGVsUmF0aW8gPSAxO1xyXG4gICAgICAgIHRoaXMuc2V0dXAoKTtcclxuICAgIH1cclxuICAgIHNldHVwKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FudmFzID0geWllbGQgdGhpcy5jcmVhdGVDYW52YXModGhpcy50YXJnZXQpO1xyXG4gICAgICAgICAgICB0aGlzLnRhcmdldC5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcyk7XHJcbiAgICAgICAgICAgIE9ic2VydmVyXzEuZGVmYXVsdC5zdWJzY3JpYmUoe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB0aGlzLnRhcmdldCxcclxuICAgICAgICAgICAgICAgIG9uVmlzaWJsZTogKCkgPT4gKHRoaXMuYmxvY2tSZXBhaW50ID0gZmFsc2UpLFxyXG4gICAgICAgICAgICAgICAgb25JbnZpc2libGU6ICgpID0+ICh0aGlzLmJsb2NrUmVwYWludCA9IHRydWUpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgbG9hZEltYWdlKHNyYykge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgICAgICBpbWcuc3JjID0gc3JjO1xyXG4gICAgICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZShyID0+IChpbWcub25sb2FkID0gcikpO1xyXG4gICAgICAgICAgICByZXR1cm4gaW1nO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlQ2FudmFzKHRhcmdldCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIC8vIGxvYWRpbmcgaW1hZ2VzSW1hZ2UgZWxlbWVudHNcclxuICAgICAgICAgICAgY29uc3QgaW1nID0geWllbGQgdGhpcy5sb2FkSW1hZ2UodGhpcy5zcmMpO1xyXG4gICAgICAgICAgICBjb25zdCBkZXB0aEltZyA9IHlpZWxkIHRoaXMubG9hZEltYWdlKHRoaXMuZGVwdGhTcmMpO1xyXG4gICAgICAgICAgICAvLyBjcmVhdGluZyBDYW52YXMgZWxlbWVudCB3aXRoIHNpemUgb2YgbG9hZGVkIGltYWdlXHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0ICogdGhpcy5waXhlbFJhdGlvO1xyXG4gICAgICAgICAgICBjYW52YXMud2lkdGggPSBpbWcud2lkdGggKiB0aGlzLnBpeGVsUmF0aW87XHJcbiAgICAgICAgICAgIGNvbnN0IGdsID0gY2FudmFzLmdldENvbnRleHQoXCJ3ZWJnbFwiKTtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjYW52YXMuc3R5bGUsIHtcclxuICAgICAgICAgICAgICAgIG1heFdpZHRoOiBcIjEwMHZ3XCIsXHJcbiAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IFwiMTAwdmhcIixcclxuICAgICAgICAgICAgICAgIG9iamVjdEZpdDogXCJjb250YWluXCIsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IFwiMTAwJVwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcik7XHJcbiAgICAgICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KFstMSwgLTEsIC0xLCAxLCAxLCAtMSwgMSwgMV0pLCBnbC5TVEFUSUNfRFJBVyk7XHJcbiAgICAgICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoMCwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcclxuICAgICAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMCk7XHJcbiAgICAgICAgICAgIC8vIGNyZWF0aW5nIHNoYWRlcnNcclxuICAgICAgICAgICAgY29uc3QgdlNoYWRlciA9IHZlcnRleF8xLmRlZmF1bHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHZzID0gZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpO1xyXG4gICAgICAgICAgICBnbC5zaGFkZXJTb3VyY2UodnMsIHZTaGFkZXIpO1xyXG4gICAgICAgICAgICBnbC5jb21waWxlU2hhZGVyKHZzKTtcclxuICAgICAgICAgICAgY29uc3QgZlNoYWRlciA9IGZyYWdtZW50XzEuZGVmYXVsdDtcclxuICAgICAgICAgICAgY29uc3QgZnMgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVSKTtcclxuICAgICAgICAgICAgZ2wuc2hhZGVyU291cmNlKGZzLCBmU2hhZGVyKTtcclxuICAgICAgICAgICAgZ2wuY29tcGlsZVNoYWRlcihmcyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7XHJcbiAgICAgICAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCBmcyk7XHJcbiAgICAgICAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2cyk7XHJcbiAgICAgICAgICAgIGdsLmxpbmtQcm9ncmFtKHByb2dyYW0pO1xyXG4gICAgICAgICAgICBnbC51c2VQcm9ncmFtKHByb2dyYW0pO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRUZXh0dXJlKGltYWdlLCBuYW1lLCBudW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCArIG51bSk7XHJcbiAgICAgICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXh0dXJlKTtcclxuICAgICAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpO1xyXG4gICAgICAgICAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7XHJcbiAgICAgICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTtcclxuICAgICAgICAgICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQSwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgaW1hZ2UpO1xyXG4gICAgICAgICAgICAgICAgZ2wudW5pZm9ybTFpKGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBuYW1lKSwgbnVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXRUZXh0dXJlKGltZywgXCJpbWdcIiwgMCk7XHJcbiAgICAgICAgICAgIHNldFRleHR1cmUoZGVwdGhJbWcsIFwiZGVwdGhcIiwgMSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxvb3AgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ibG9ja1JlcGFpbnQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgZ2wuY2xlYXJDb2xvcigwLjI1LCAwLjY1LCAxLCAxKTtcclxuICAgICAgICAgICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpO1xyXG4gICAgICAgICAgICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgMCwgNCk7XHJcbiAgICAgICAgICAgICAgICAvLyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gbG9vcCgpKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgbG9vcCgpO1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBmcmFnbWVudF8xLk1PVVNFX1ZFQ1RPUl9OQU1FKTtcclxuICAgICAgICAgICAgY2FudmFzLm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1vdXNlUG9zaXRpb24gPSBnZXRSZWxhdGl2ZU1vdXNlUG9zaXRpb25fMS5nZXRSZWxhdGl2ZU1vdXNlUG9zaXRpb24oZSk7XHJcbiAgICAgICAgICAgICAgICBnbC51bmlmb3JtMmZ2KGxvY2F0aW9uLCBuZXcgRmxvYXQzMkFycmF5KG1vdXNlUG9zaXRpb24pKTtcclxuICAgICAgICAgICAgICAgIC8vIHJlbmRlciBuZXh0IGZyYW1lIG9uIG1vdXNlIG1vdmVcclxuICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBsb29wKCkpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvLyBUT0RPIGludGVyZmFjZSBmb3IgYWxwYSxiZXRhLGdhbW1hXHJcbiAgICAgICAgICAgIGNvbnN0IG9uRGV2aWNlTW90aW9uID0gKGFscGhhLCBiZXRhLCBnYW1tYSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgUkFUSU8gPSAwLjAxNTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZVBvc2l0aW9uID0gWy1SQVRJTyAqIGdhbW1hLCAtUkFUSU8gKiBiZXRhXTtcclxuICAgICAgICAgICAgICAgIGdsLnVuaWZvcm0yZnYobG9jYXRpb24sIG5ldyBGbG9hdDMyQXJyYXkoZGV2aWNlUG9zaXRpb24pKTtcclxuICAgICAgICAgICAgICAgIC8vIHJlbmRlciBuZXh0IGZyYW1lIG9uIG1vdXNlIG1vdmVcclxuICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBsb29wKCkpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBnZXRSZWxhdGl2ZU1vdXNlUG9zaXRpb25fMS5EZXZpY2VPcmllbnRhdGlvbi5zdWJzY3JpYmUob25EZXZpY2VNb3Rpb24pO1xyXG4gICAgICAgICAgICB0aGlzLmdsID0gZ2w7XHJcbiAgICAgICAgICAgIHJldHVybiBjYW52YXM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5kZWZhdWx0ID0gSW1hZ2UzRDtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy8gaW9pZCA9IGludGVyc2VjdGlvbiBvYnNlcnZlciBpZFxyXG5jb25zdCBJRF9BVFRSX05BTUUgPSBcImRhdGEtaW9pZFwiO1xyXG4vKipcclxuICogLSBvYnNlcnZlcyBzdWJzY3JpYmVkIEhUTUxFbGVtZW50cyBhbmQgdHJpZ2dlcnMgY2FsbGJhY2tzIHdoZW4gZWxlbWVudCBhcHBlYXJzL2Rpc2FwcGVhcnMgZnJvbSB0aGUgdmlld3BvcnRcclxuICovXHJcbmNsYXNzIE9ic2VydmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlcnMgPSB7fTtcclxuICAgICAgICB0aGlzLnN1YnNjcmliZXJzQ291bnQgPSAwO1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIHJvb3Q6IG51bGwsXHJcbiAgICAgICAgICAgIHJvb3RNYXJnaW46IFwiMHB4IDBweCAwcHggMHB4XCIsXHJcbiAgICAgICAgICAgIHRocmVzaG9sZDogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAoZW50cmllcykgPT4ge1xyXG4gICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZW50cnkudGFyZ2V0O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKElEX0FUVFJfTkFNRSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJzY3JpYmVyID0gdGhpcy5zdWJzY3JpYmVyc1tpZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoIXN1YnNjcmliZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlci5vblZpc2libGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlZJU0lCTEUhXCIsIHRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLm9uSW52aXNpYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJpbnZpc2libGUhXCIsIHRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25PYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihjYWxsYmFjaywgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICBzdWJzY3JpYmUoc3Vic2NyaWJlcikge1xyXG4gICAgICAgIGNvbnN0IHsgdGFyZ2V0LCBvblZpc2libGUsIG9uSW52aXNpYmxlIH0gPSBzdWJzY3JpYmVyO1xyXG4gICAgICAgIGlmICghdGFyZ2V0KVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVyc0NvdW50Kys7XHJcbiAgICAgICAgLy8gZ2VuZXJhdGluZyBpZCAoa2V5KVxyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5zdWJzY3JpYmVyc0NvdW50LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgLy8gYXNzaWduaW5nIGlkIHRvIHRhcmdldCBlbGVtZW50XHJcbiAgICAgICAgdGFyZ2V0LnNldEF0dHJpYnV0ZShJRF9BVFRSX05BTUUsIGlkKTtcclxuICAgICAgICAvLyBrZWVwIHJlZmVyZW5jZSB0byB0aGF0IG9iamVjdFxyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlcnNbaWRdID0gc3Vic2NyaWJlcjtcclxuICAgICAgICB0aGlzLmludGVyc2VjdGlvbk9ic2VydmVyLm9ic2VydmUodGFyZ2V0KTtcclxuICAgIH1cclxuICAgIHVuc3Vic2NyaWJlKHRhcmdldCkgeyB9XHJcbn1cclxuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IE9ic2VydmVyKCk7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG4vLyBzaGFkZXIgc3RvbGVuIGZyb20gaHR0cHM6Ly9jb2RlcGVuLmlvL2tlaWx5bjNkL3Blbi9LTFZ4Wk1cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLmRlZmF1bHQgPSBgXHJcbiAgICBhdHRyaWJ1dGUgdmVjMiBwb3M7XHJcbiAgICB2YXJ5aW5nIHZlYzIgdnBvcztcclxuICAgIHZvaWQgbWFpbigpe1xyXG4gICAgICAgIHZwb3MgPSBwb3MqLTAuNSArIHZlYzIoMC41KTtcclxuICAgICAgICBnbF9Qb3NpdGlvbiA9IHZlYzQocG9zLCAwLjAsIDEuMCk7XHJcbiAgICB9XHJcbiAgICBgO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLk1PVVNFX1ZFQ1RPUl9OQU1FID0gXCJtb3VzZVwiO1xyXG4vLyBzaGFkZXIgc3RvbGVuIGZyb20gaHR0cHM6Ly9jb2RlcGVuLmlvL2tlaWx5bjNkL3Blbi9LTFZ4Wk1cclxuZXhwb3J0cy5kZWZhdWx0ID0gYFxyXG4gICAgcHJlY2lzaW9uIGhpZ2hwIGZsb2F0O1xyXG4gICAgdW5pZm9ybSBzYW1wbGVyMkQgaW1nO1xyXG4gICAgdW5pZm9ybSBzYW1wbGVyMkQgZGVwdGg7XHJcbiAgICB1bmlmb3JtIHZlYzIgJHtleHBvcnRzLk1PVVNFX1ZFQ1RPUl9OQU1FfTtcclxuICAgIHZhcnlpbmcgdmVjMiB2cG9zO1xyXG4gICAgdm9pZCBtYWluKCl7XHJcbiAgICAgICAgZmxvYXQgZHAgPSAtMC41ICsgdGV4dHVyZTJEKGRlcHRoLCB2cG9zKS54O1xyXG4gICAgICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChpbWcsIHZwb3MgKyAke2V4cG9ydHMuTU9VU0VfVkVDVE9SX05BTUV9ICogMC4yICogZHApO1xyXG4gICAgfVxyXG4gICAgYDtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIGdldHMgbW91c2UgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGFyZ2V0IGVsZW1lbnQgaW4gJVxyXG4vLyByZXR1cm5zIHZhbHVlcyBpbiByYW5nZSAtMC41IHRvIDAuNSwgc28gWzAsIDBdIGlzIGNlbnRlclxyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmZ1bmN0aW9uIGdldFJlbGF0aXZlTW91c2VQb3NpdGlvbihlKSB7XHJcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcclxuICAgIC8vIGhvdyB0byBkbyBkZXN0cnVjdHVyaW5nIGFzc2lnbm1lbnQgaW4gVFM/IPCfmIJcclxuICAgIGNvbnN0IHJlY3QgPSB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICBjb25zdCB3aWR0aCA9IHJlY3Qud2lkdGg7XHJcbiAgICBjb25zdCBoZWlnaHQgPSByZWN0LmhlaWdodDtcclxuICAgIGNvbnN0IGxlZnQgPSByZWN0LmxlZnQ7XHJcbiAgICBjb25zdCB0b3AgPSByZWN0LnRvcDtcclxuICAgIGNvbnN0IHBYID0gLTAuNSArIChlLmNsaWVudFggLSBsZWZ0KSAvIHdpZHRoO1xyXG4gICAgY29uc3QgcFkgPSAwLjUgLSAoZS5jbGllbnRZIC0gdG9wKSAvIGhlaWdodDtcclxuICAgIHJldHVybiBbcFgsIHBZXTtcclxufVxyXG5leHBvcnRzLmdldFJlbGF0aXZlTW91c2VQb3NpdGlvbiA9IGdldFJlbGF0aXZlTW91c2VQb3NpdGlvbjtcclxuY2xhc3MgRGV2aWNlT3JpZW50YXRpb25NYW5hZ2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlcnMgPSBbXTtcclxuICAgICAgICB0aGlzLmluaXRpYWxEYXRhID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRhdGEgPSB7XHJcbiAgICAgICAgICAgIGFscGhhOiAwLFxyXG4gICAgICAgICAgICBiZXRhOiAwLFxyXG4gICAgICAgICAgICBnYW1tYTogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJkZXZpY2VvcmllbnRhdGlvblwiLCBlID0+IHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVPcmllbnRhdGlvbkRhdGEoZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlcnMuZm9yRWFjaChzdWJzY3JpYmVyID0+IHtcclxuICAgICAgICAgICAgICAgIHN1YnNjcmliZXIodGhpcy5kYXRhLmFscGhhLCB0aGlzLmRhdGEuYmV0YSwgdGhpcy5kYXRhLmdhbW1hKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgZmFsc2UpO1xyXG4gICAgfVxyXG4gICAgc3Vic2NyaWJlKGZuKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVycy5wdXNoKGZuKTtcclxuICAgIH1cclxuICAgIHVwZGF0ZU9yaWVudGF0aW9uRGF0YShlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxEYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBhbHBoYTogZS5hbHBoYSxcclxuICAgICAgICAgICAgICAgIGJldGE6IGUuYmV0YSxcclxuICAgICAgICAgICAgICAgIGdhbW1hOiBlLmdhbW1hXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGF0YS5hbHBoYSA9IGUuYWxwaGEgLSB0aGlzLmluaXRpYWxEYXRhLmFscGhhO1xyXG4gICAgICAgIHRoaXMuZGF0YS5nYW1tYSA9ICgtZS5nYW1tYSArIHRoaXMuaW5pdGlhbERhdGEuZ2FtbWEpICogLTE7XHJcbiAgICAgICAgdGhpcy5kYXRhLmJldGEgPSAoZS5iZXRhIC0gdGhpcy5pbml0aWFsRGF0YS5iZXRhKSAqIC0xO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuRGV2aWNlT3JpZW50YXRpb24gPSBuZXcgRGV2aWNlT3JpZW50YXRpb25NYW5hZ2VyKCk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=